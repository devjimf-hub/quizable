<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizable | Modern Quiz Platform</title>

    <!-- Dependencies -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.jpg" type="image/jpeg">
</head>

<body>
    <div class="container">
        <!-- Teacher Dashboard -->
        <div id="teacher-menu" class="card hidden">
            <h1>Teacher Dashboard</h1>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 30px;">Manage your quizzes and track
                student progress with ease.</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <button id="go-to-create-quiz" class="btn btn-primary" style="height: 120px; flex-direction: column;">
                    <span style="font-size: 1.5rem;">üìù</span>
                    Create New Quiz
                </button>
                <button id="go-to-view-results" class="btn btn-info" style="height: 120px; flex-direction: column;">
                    <span style="font-size: 1.5rem;">üìä</span>
                    View Results
                </button>
            </div>
        </div>

        <!-- Quiz Creator -->
        <div id="teacher-create-section" class="card hidden">
            <button class="btn btn-outline" onclick="showTeacherMenu()">‚Üê Dashboard</button>
            <h1 style="margin-top: 20px;">Quiz Creator</h1>

            <div class="card" style="background: var(--bg-body); padding: 25px; border-style: dashed;">
                <h2>Import Questions</h2>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <label for="json-upload" class="btn btn-info">Upload JSON</label>
                    <input type="file" id="json-upload" accept=".json" style="display: none;">
                    <span id="json-file-name" style="color: var(--text-muted);">No file chosen</span>
                    <button id="load-from-json" class="btn btn-outline">Load File</button>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label>Or Paste JSON</label>
                    <textarea id="pasted-json-input" rows="4"
                        placeholder="Paste your quiz JSON structure here..."></textarea>
                    <button id="load-from-pasted-json" class="btn btn-outline" style="margin-top: 10px;">Load From
                        Text</button>
                </div>
                <!-- JSON Example -->
                <details style="margin-top: 15px; cursor: pointer;">
                    <summary style="font-weight: 600; color: var(--primary);">View JSON Structure Example</summary>
                    <div class="json-template">
                        <pre>{
                            "title": "Sample Quiz",
                            "questions": [
                                { 
                                "text": "What is 2+2?", 
                                "options": ["3", "4", "5"], 
                                "correctAnswer": 1, 
                                "figure": "&lt;svg&gt;...&lt;/svg&gt;" 
                                }
                            ]
                            }
                        </pre>
                    </div>
                </details>
            </div>

            <div class="form-group">
                <label>Quiz Title</label>
                <input type="text" id="quiz-title" placeholder="e.g., Final Examination - Web Dev">
            </div>
            <div class="form-group">
                <label>Subject</label>
                <input type="text" id="quiz-subject" placeholder="e.g., Information Technology">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Duration (Minutes)</label>
                    <input type="number" id="quiz-duration" value="0">
                </div>
                <div class="form-group">
                    <label>Expiry Date/Time</label>
                    <input type="datetime-local" id="quiz-expiry">
                </div>
            </div>

            <div class="form-group">
                <label>Encryption Key (Secret)</label>
                <input type="text" id="secret-key" placeholder="Enter a strong password for this quiz">
            </div>

            <div style="margin-bottom: 30px;">
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="show-results-to-student" checked> Show score to students after submission
                </label>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; margin-top:10px;">
                    <input type="checkbox" id="save-results-to-cloud" checked> Save results to Firebase Cloud
                </label>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; margin-top:10px;">
                    <input type="checkbox" id="randomize-order" checked> Randomize question & option order
                </label>
            </div>

            <div id="questions-container"></div>

            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button id="add-question" class="btn btn-outline">Add Question</button>
                <button id="generate-encrypted-file" class="btn btn-success" style="flex-grow: 1;">Save Quiz to
                    Cloud</button>
            </div>
        </div>

        <!-- Student Results Viewer -->
        <div id="teacher-results-section" class="card hidden">
            <button class="btn btn-outline" onclick="showTeacherMenu()">‚Üê Dashboard</button>
            <h1 style="margin-top: 20px;">Analytics & Results</h1>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Quiz ID</label>
                    <input type="text" id="results-quiz-id" placeholder="Paste the Quiz ID">
                </div>
                <div class="form-group">
                    <label>Secret Key</label>
                    <input type="text" id="results-secret-key" placeholder="Enter encryption key">
                </div>
            </div>
            <button id="view-results-btn" class="btn btn-primary" style="width: 100%;">Fetch Records</button>

            <div id="section-selector-container" class="hidden"
                style="margin-top: 30px; padding: 20px; background: var(--bg-body); border-radius: 12px;">
                <h3>Filters</h3>
                <div id="section-checkboxes" style="display: flex; gap: 15px; flex-wrap: wrap; margin: 15px 0;"></div>
                <button id="merge-sections-btn" class="btn btn-outline">Apply Filter</button>
            </div>

            <div id="student-results-display" style="margin-top: 30px;"></div>
            <button id="export-pdf-btn" class="btn btn-info hidden" style="width: 100%; margin-top: 20px;">Export to
                Professional PDF</button>
        </div>

        <!-- Student Entry Screen -->
        <div id="student-section" class="card">
            <h1>Student Portal</h1>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 30px;">Please enter the details
                provided by your teacher to begin.</p>

            <div class="form-group">
                <label>Quiz ID</label>
                <input type="text" id="student-quiz-id" placeholder="Enter ID">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" id="student-first-name" placeholder="John">
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" id="student-last-name" placeholder="Doe">
                </div>
            </div>
            <div class="form-group">
                <label>Year & Section</label>
                <input type="text" id="student-year-section" placeholder="e.g., BSIT-3A">
            </div>
            <div class="form-group">
                <label>Access Key</label>
                <input type="text" id="student-secret-key" placeholder="Provided by teacher">
            </div>
            <button id="start-quiz" class="btn btn-primary"
                style="width: 100%; height: 55px; font-size: 1.1rem; margin-top: 10px;">Verify & Start Quiz</button>
        </div>

        <!-- Quiz Interface -->
        <div id="quiz-section" class="card hidden">
            <div id="timer-display" class="timer-display hidden">
                <span>‚è±Ô∏è</span> Time Left: 00:00
            </div>
            <h2 id="quiz-title-display" style="text-align: center; margin-bottom: 20px;">Quiz</h2>
            <div class="progress-bar">
                <div class="progress" id="quiz-progress"></div>
            </div>
            <div id="quiz-questions"></div>
            <div id="quiz-review" class="hidden"></div>
        </div>

        <!-- Final Results Screen -->
        <div id="results-section" class="card hidden">
            <h1>Quiz Completed</h1>
            <div id="submission-success-message" style="text-align: center; padding: 40px;">
                <div style="font-size: 4rem; margin-bottom: 20px;">‚úÖ</div>
                <h2>Success!</h2>
                <p>Your responses have been securely encrypted and submitted to the cloud.</p>
            </div>
            <div id="student-score-summary" class="hidden"></div>
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button id="restart-quiz" class="btn btn-outline" style="flex: 1;">Return Home</button>
                <button id="download-student-pdf-btn" class="btn btn-primary hidden" style="flex: 2;">Download Results
                    (PDF)</button>
            </div>
        </div>

        <!-- Proctoring System -->
        <div id="tab-warning" class="tab-warning hidden">
            <div style="font-size: 4rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
            <h2>Tab Switch Detected</h2>
            <p style="max-width: 400px; margin-bottom: 30px;">You are not allowed to leave this window during the quiz.
                This attempt has been logged.</p>
            <div style="font-size: 1.2rem; font-weight: 700; color: var(--danger); margin-bottom: 30px;">
                Attempts remaining: <span id="remaining-attempts">3</span>
            </div>
            <button id="return-to-quiz" class="btn btn-primary">I Understand, Return to Quiz</button>
        </div>

        <div id="attempts-counter" class="attempts-counter hidden"
            style="position: fixed; top: 20px; right: 20px; background: var(--danger); color: white; padding: 8px 16px; border-radius: 100px; font-weight: 700; z-index: 1000; box-shadow: var(--shadow);">
            Attempts: 0/3
        </div>

        <!-- Modals -->
        <div id="confirmation-modal" class="modal-overlay hidden"
            style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 3000;">
            <div class="modal-content">
                <h2 id="modal-title">Confirm</h2>
                <p id="modal-message" style="color: var(--text-muted); margin: 15px 0 25px 0;"></p>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="modal-cancel-btn" class="btn btn-outline">Cancel</button>
                    <button id="modal-confirm-btn" class="btn btn-primary">Confirm</button>
                </div>
            </div>
        </div>

        <div id="instruction-modal" class="modal-overlay hidden"
            style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 3000;">
            <div class="modal-content" style="max-width: 500px;">
                <h2>Quiz Instructions</h2>
                <div style="text-align: left; margin: 20px 0; line-height: 1.8;">
                    <p>‚Ä¢ Do not switch tabs or minimize the browser.</p>
                    <p>‚Ä¢ Right-click and copy/paste are disabled.</p>
                    <p>‚Ä¢ The quiz ends automatically when time expires.</p>
                    <p>‚Ä¢ DevTools detection is active.</p>
                </div>
                <div style="background: var(--bg-body); padding: 20px; border-radius: 12px; text-align: center;">
                    <p style="font-weight: 600; color: var(--text-muted); margin-bottom: 5px;">Starting in</p>
                    <div id="instruction-countdown" style="font-size: 3rem; font-weight: 800; color: var(--primary);">30
                    </div>
                </div>
            </div>
        </div>
        <!-- Global Loading Overlay -->
        <div id="loading-overlay" class="hidden"
            style="position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;">
            <div class="loader-spinner"></div>
            <p style="color: white; margin-top: 20px; font-weight: 600; font-family: var(--font-heading);">Processing,
                please wait...</p>
        </div>

        <!-- Logic -->
        <script src="script.js"></script>
</body>

</html>