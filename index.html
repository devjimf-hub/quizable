<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizable | Modern Quiz Platform</title>

    <!-- Dependencies -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.jpg" type="image/jpeg">
</head>

<body>
    <div id="quiz-watermark" class="quiz-watermark"></div>
    <div id="quiz-watermark-dynamic" class="quiz-watermark dynamic"></div>
    <div class="print-violation-msg">
        <h1>SECURITY VIOLATION</h1>
        <p>Printing is strictly prohibited during this examination.</p>
        <p>This attempt has been logged and reported to the instructor.</p>
    </div>
    <div class="container">
        <!-- Teacher Dashboard -->
        <div id="teacher-menu" class="card hidden">
            <h1>Teacher Dashboard</h1>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 30px;">Manage your quizzes and track
                student progress with ease.</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <button id="go-to-create-quiz" class="btn btn-primary"
                    style="height: 120px; flex-direction: column; gap: 10px;">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Create New Quiz
                </button>
                <button id="go-to-view-results" class="btn btn-info"
                    style="height: 120px; flex-direction: column; gap: 10px;">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    View Results
                </button>
            </div>
        </div>

        <!-- Quiz Creator -->
        <div id="teacher-create-section" class="card hidden">
            <button class="btn btn-outline" onclick="showTeacherMenu()"
                style="display: flex; align-items: center; gap: 8px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Dashboard
            </button>
            <h1 style="margin-top: 20px;">Quiz Creator</h1>

            <div class="card" style="background: var(--bg-body); padding: 25px; border-style: dashed;">
                <h2>Import Questions</h2>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <label for="json-upload" class="btn btn-info">Upload JSON</label>
                    <input type="file" id="json-upload" accept=".json" style="display: none;">
                    <span id="json-file-name" style="color: var(--text-muted);">No file chosen</span>
                    <button id="load-from-json" class="btn btn-outline">Load File</button>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label>Or Paste JSON</label>
                    <textarea id="pasted-json-input" rows="4"
                        placeholder="Paste your quiz JSON structure here..."></textarea>
                    <button id="load-from-pasted-json" class="btn btn-outline" style="margin-top: 10px;">Load From
                        Text</button>
                </div>
                <!-- JSON Example -->
                <details style="margin-top: 15px; cursor: pointer;">
                    <summary style="font-weight: 600; color: var(--primary);">View JSON Structure Example</summary>
                    <div class="json-template" style="position:relative;">
                        <button onclick="copyJsonTemplate()" class="btn btn-outline"
                            style="position:absolute; top:10px; right:10px; padding:5px 10px; font-size:0.8rem;">Copy</button>
                        <pre id="json-example-code">{
                            "title": "Sample Quiz",
                            "questions": [
                                { 
                                "text": "What is 2+2?", 
                                "options": ["3", "4", "5"], 
                                "correctAnswer": 1, 
                                "figure": "&lt;svg&gt;...&lt;/svg&gt;" 
                                }
                            ]
                            }
                        </pre>
                    </div>
                </details>
            </div>

            <div class="form-group">
                <label>Quiz Title</label>
                <input type="text" id="quiz-title" placeholder="e.g., Final Examination - Web Dev">
            </div>
            <div class="form-group">
                <label>Subject</label>
                <input type="text" id="quiz-subject" placeholder="e.g., Information Technology">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Duration (Minutes)</label>
                    <input type="number" id="quiz-duration" value="0">
                </div>
                <div class="form-group">
                    <label>Expiry Date/Time</label>
                    <input type="datetime-local" id="quiz-expiry">
                </div>
            </div>

            <div class="form-group">
                <label>Encryption Key (Secret)</label>
                <input type="text" id="secret-key" placeholder="Enter a strong password for this quiz">
            </div>

            <div style="margin-bottom: 30px;">
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="show-results-to-student" checked> Show score to students after submission
                </label>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; margin-top:10px;">
                    <input type="checkbox" id="save-results-to-cloud" checked> Save results to Firebase Cloud
                </label>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; margin-top:10px;">
                    <input type="checkbox" id="randomize-order" checked> Randomize question & option order
                </label>
                <!-- Hidden Config -->
                <input type="hidden" id="instruction-countdown-duration" value="5">
            </div>

            <div id="questions-container"></div>



            <div style="display: flex; gap: 15px; margin-top: 30px;">

                <button id="add-question" class="btn btn-outline">Add Question</button>
                <button onclick="exportDraftAsJson()" class="btn btn-info" style="gap:8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export Structure
                </button>
                <button id="generate-encrypted-file" class="btn btn-success" style="flex-grow: 1;">Save Quiz to
                    Cloud</button>
            </div>
        </div>

        <!-- Student Results Viewer -->
        <div id="teacher-results-section" class="card hidden">
            <button class="btn btn-outline" onclick="showTeacherMenu()"
                style="display: flex; align-items: center; gap: 8px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Dashboard
            </button>
            <h1 style="margin-top: 20px;">Analytics & Results</h1>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Quiz ID</label>
                    <input type="text" id="results-quiz-id" placeholder="Paste the Quiz ID">
                </div>
                <div class="form-group">
                    <label>Secret Key</label>
                    <input type="text" id="results-secret-key" placeholder="Enter encryption key">
                </div>
            </div>
            <button id="view-results-btn" class="btn btn-primary" style="width: 100%;">Fetch Records</button>

            <!-- Recent Quizzes List -->
            <div id="recent-quizzes-container" class="hidden" style="margin-top: 20px;">
                <label style="color:var(--text-muted); font-size:0.9rem;">Recent Quizzes</label>
                <div id="recent-quizzes-list" style="display:flex; flex-direction:column; gap:10px; margin-top:10px;">
                </div>
            </div>

            <div id="section-selector-container" class="hidden"
                style="margin-top: 30px; padding: 20px; background: var(--bg-body); border-radius: 12px;">
                <h3>Filters</h3>
                <div id="section-checkboxes" style="display: flex; gap: 15px; flex-wrap: wrap; margin: 15px 0;"></div>
                <button id="merge-sections-btn" class="btn btn-outline">Apply Filter</button>
            </div>

            <div id="student-results-display" style="margin-top: 30px;"></div>

            <!-- Quiz Management (New Feature) -->
            <details id="quiz-management-container" class="hidden"
                style="margin-top: 30px; padding: 20px; background: var(--bg-body); border-radius: 12px; border: 1px solid var(--border);">
                <summary
                    style="cursor: pointer; font-family: var(--font-heading); font-size: 1.2rem; font-weight: 700; color: var(--text-main); display: flex; align-items: center; justify-content: space-between; outline: none;">
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                        Quiz Management
                    </span>
                    <span style="font-size: 0.8rem; color: var(--primary); font-weight: 600;">Click to
                        Expand/Collapse</span>
                </summary>

                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Modify Duration (Mins)</label>
                            <input type="number" id="modify-quiz-duration" placeholder="0 for unlimited">
                        </div>
                        <div class="form-group">
                            <label>Modify Expiry Date/Time</label>
                            <input type="datetime-local" id="modify-quiz-expiry">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 10px;">
                        <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                            <input type="checkbox" id="modify-show-results"> Show score to students after submission
                        </label>
                    </div>

                    <button id="update-quiz-settings-btn" class="btn btn-warning"
                        style="width: 100%; margin-top: 10px;">Update Quiz Settings</button>
                </div>
            </details>

            <button id="export-pdf-btn" class="btn btn-info hidden" style="width: 100%; margin-top: 20px;">Export to
                Professional PDF</button>

        </div>

        <!-- Student Entry Screen -->
        <div id="student-section" class="card">
            <h1>Student Portal</h1>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 30px;">Please enter the details
                provided by your teacher to begin.</p>

            <div class="form-group">
                <label>Quiz ID</label>
                <input type="text" id="student-quiz-id" placeholder="Enter ID">
            </div>
            <div class="form-group">
                <label>Student ID / Institutional ID</label>
                <input type="text" id="student-id-field" placeholder="e.g. 2024-10023">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" id="student-first-name" placeholder="John">
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" id="student-last-name" placeholder="Doe">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Year Level</label>
                    <select id="student-year">
                        <option value="" disabled selected>Select Year</option>
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Section</label>
                    <select id="student-section-select">
                        <option value="" disabled selected>Select Section</option>
                        <option value="A">Section A</option>
                        <option value="B">Section B</option>
                        <option value="C">Section C</option>
                        <option value="D">Section D</option>
                        <option value="E">Section E</option>
                        <option value="F">Section F</option>
                        <option value="G">Section G</option>
                        <option value="H">Section H</option>
                        <option value="I">Section I</option>
                        <option value="J">Section J</option>
                        <option value="TAB">Section TAB</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Access Key</label>
                <input type="text" id="student-secret-key" placeholder="Provided by teacher">
            </div>
            <button id="start-quiz" class="btn btn-primary"
                style="width: 100%; height: 55px; font-size: 1.1rem; margin-top: 10px;">Verify & Start Quiz</button>
        </div>

        <!-- Quiz Interface -->
        <div id="quiz-section" class="card hidden">
            <div id="timer-display" class="timer-display hidden">
                <span>⏱️</span> Time Left: 00:00
            </div>
            <h2 id="quiz-title-display" style="text-align: center; margin-bottom: 20px;">Quiz</h2>
            <div class="progress-bar">
                <div class="progress" id="quiz-progress"></div>
            </div>
            <div id="quiz-questions"></div>
            <div id="quiz-review" class="hidden"></div>
        </div>

        <!-- Final Results Screen -->
        <div id="results-section" class="card hidden">
            <h1>Quiz Completed</h1>
            <div id="submission-success-message" style="text-align: center; padding: 40px;">
                <div style="font-size: 4rem; margin-bottom: 20px;">✅</div>
                <h2>Success!</h2>
                <p>Your responses have been securely encrypted and submitted to the cloud.</p>
            </div>
            <div id="student-score-summary" class="hidden"></div>
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button id="restart-quiz" class="btn btn-outline" style="flex: 1;">Return Home</button>
                <button id="download-student-pdf-btn" class="btn btn-primary hidden" style="flex: 2;">Download Results
                    (PDF)</button>
            </div>
        </div>

        <!-- Proctoring System -->
        <div id="tab-warning" class="tab-warning hidden">
            <div style="font-size: 4rem; margin-bottom: 20px;">⚠️</div>
            <h2>Tab Switch Detected</h2>
            <p style="max-width: 400px; margin-bottom: 30px;">You are not allowed to leave this window during the quiz.
                This attempt has been logged.</p>
            <div style="font-size: 1.2rem; font-weight: 700; color: var(--danger); margin-bottom: 30px;">
                Attempts remaining: <span id="remaining-attempts">3</span>
            </div>
            <button id="return-to-quiz" class="btn btn-primary">I Understand, Return to Quiz</button>
        </div>

        <div id="attempts-widget" class="attempts-widget hidden">
            <div class="widget-content">
                <span id="attempts-number" class="widget-number">0</span>
                <span id="attempts-text" class="widget-text">attempts to cheat, you will get disqualified on 3</span>
            </div>
        </div>

        <!-- Modals -->
        <div id="confirmation-modal" class="modal-overlay hidden"
            style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 3000;">
            <div class="modal-content">
                <h2 id="modal-title">Confirm</h2>
                <p id="modal-message" style="color: var(--text-muted); margin: 15px 0 25px 0;"></p>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="modal-cancel-btn" class="btn btn-outline">Cancel</button>
                    <button id="modal-confirm-btn" class="btn btn-primary">Confirm</button>
                </div>
            </div>
        </div>

        <div id="instruction-modal" class="modal-overlay hidden"
            style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 3000;">
            <div class="modal-content" style="max-width: 500px;">
                <h2>Quiz Instructions</h2>
                <div style="text-align: left; margin: 20px 0; line-height: 1.8;">
                    <p>• Do not switch tabs or minimize the browser.</p>
                    <p>• Right-click and copy/paste are disabled.</p>
                    <p>• The quiz ends automatically when time expires.</p>
                    <p>• DevTools detection is active.</p>
                </div>
                <div style="background: var(--bg-body); padding: 20px; border-radius: 12px; text-align: center;">
                    <p style="font-weight: 600; color: var(--text-muted); margin-bottom: 5px;">Starting in</p>
                    <div id="instruction-countdown" style="font-size: 3rem; font-weight: 800; color: var(--primary);">30
                    </div>
                </div>
            </div>
        </div>
        <!-- Global Loading Overlay -->
        <div id="loading-overlay" class="hidden"
            style="position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;">
            <div class="loader-spinner"></div>
            <p style="color: white; margin-top: 20px; font-weight: 600; font-family: var(--font-heading);">Processing,
                please wait...</p>
        </div>

        <!-- Logic -->
        <div id="quiz-navigator" class="quiz-navigator hidden"></div>
        <div id="toast-container" class="toast-container"></div>
        <script src="script.js"></script>
</body>

</html>